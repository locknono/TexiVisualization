<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" charset="utf-8">

<head>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">

    <!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
        crossorigin="anonymous">

    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>
    <style type="text/css">
        .hexagon {
            stroke: #fff;
            stroke-width: 0.5px;
            fill: none;
        }

        .hexagon2 {
            stroke: #fff;
            stroke-width: 0.3px;
        }

        .mapradio {}

        div#a1 {
            position: relative;
        }

        div#a3 {
            background-color: none;
            position: absolute;
            z-index: 2
        }
    </style>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="百度地图,百度地图API，百度地图自定义工具，百度地图所见即所得工具" />
    <meta name="description" content="百度地图API自定义地图，帮助用户在可视化操作下生成百度地图" />
    <title>百度地图API自定义地图</title>
    <!--引用百度地图API-->
    <style type="text/css">
        html,
        body {
            margin: 0;
            padding: 0;
        }

        .iw_poi_title {
            color: #CC5522;
            font-size: 14px;
            font-weight: bold;
            overflow: hidden;
            padding-right: 13px;
            white-space: nowrap
        }

        .iw_poi_content {
            font: 12px arial, sans-serif;
            overflow: visible;
            padding-top: 4px;
            white-space: -moz-pre-wrap;
            word-wrap: break-word
        }

        div#pie {}

        .tooltip {
            position: absolute;
            width: 120px;
            height: auto;
            font-family: simsun;
            font-size: 14px;
            text-align: center;
            color: white;
            border-width: 2px solid black;
            background-color: black;
            border-radius: 5px;
        }

        .tooltip:after {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 20%;
            margin-left: -8px;
            width: 0;
            height: 0;
            border-bottom: 12px solid black;
            border-right: 12px solid transparent;
            border-left: 12px solid transparent;
        }

        .axis line {
            fill: none;
            stroke: black;
            shape-rendering: crispEdges;
        }

        .axis text {
            stroke: black;
        }

        .axis2 text {
            fill: none;
        }

        circle {
            stroke-width: 1.5px;
        }

        /*line {
  stroke: #999;
} */
    </style>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=WxIeopW5cdcgRNsLcLYKuEY8hj0ZlGon"></script>
    <script type="text/javascript" src="http://d3js.org/d3.v3.js"></script>
    <script type="text/javascript" src="LuShu_min.js"></script>
    <script type="text/javascript" src="js/laydate.js"></script>
</head>

<body>
    <!--百度地图容器-->
    <div class="row">
        <div class="col-md-6">

            <div id="a1" class="col-md-12">
                <div class="panel panel-default" style="height:385px;width:697px;position:absolute;border:#ccc;z-index:1 solid 1px;" id="dituContent">
                    <img src="./map.png">
                </div>

                <div id="a3">


                </div>

            </div>
            <!-- <input id="mapinput" type="range" min="0" max="288" step="1" value="0" style="position:absolute;top:395px;left:40px;width:650px"> -->
            </br>
            <!--     <div class="col-md-3">
    <div class="panel panel-default" style="position:absolute;top:385px;width:145px"> -->
            <!-- <div class="panel-body">
          <h4><span class="label label-default" id="timesqan">00:00:00</span></h4>
          <br/>
                <select name="bendi" id="bendi" onchange="load(this.options[this.options.selectedIndex].value)">
                <option value="22">选择车辆编号</option>
                <option value="5">5</option>
                <option value="27">27</option>
                <option value="80">80</option>
                <option value="106">106</option>
                <option value="110">110</option>
                <option value="116">116</option>
                <option value="125">125</option>
                <option value="129">129</option>
                <option value="130">130</option>
                <option value="163">163</option>
                <option value="233">233</option>
            </select>
            <form>
            <br/>
                  <label><input type="radio" name="mode" value="num" class="mapradio" checked> 车辆分布</label>
                  <label><input type="radio" name="mode" value="v" class="mapradio" > 速度</label>
            </form>
            <form>
                  <label><input type="radio" name="hexsize" value="5" class="mapradio" checked> Small</label>
                  <label><input type="radio" name="hexsize" value="10" class="mapradio" > Middle</label>
                  <label><input type="radio" name="hexsize" value="15" class="mapradio" > Large</label>
            </form>
              <div class="demo1">
              <br/>
                <input class="laydate-icon" id="demo" value=" 2011-4-28" style="width:115px"> 
               </div> -->
            <!-- <div class="col-md-9">
                <input id="pieinput" type="range" min="0" max="86400" step="1" value="0" style="width:450px">
                
            </div> -->
            <!--  </div> -->
            <!-- </div>
    </div> -->
            <div class="col-md-12">
                <div class="panel panel-default" style="position:absolute;top:385px;width:697px;">
                    <div class="panel-body">

                        <div class="col-md-6" id="pie"></div>
                        <div class="col-md-6" id="pie2"></div>
                    </div>
                </div>
            </div>

        </div>

        <div class="col-md-6">
            <div class="panel panel-default" style="height:485px;">
                <div class="panel-body">
                    <div class="col-md-8" id="foce">
                        <form>
                            <label>
                                <input type="radio" name="Historgraminput" value="1" class="mapradio" onchange="changedThresholdRadio(20)"> 20 </label>
                            <label>
                                <input type="radio" name="Historgraminput" value="2" class="mapradio" onchange="changedThresholdRadio(50)"> 50 </label>
                            <label>
                                <input type="radio" name="Historgraminput" value="3" class="mapradio" onchange="changedThresholdRadio(100)"> 100 </label>
                        </form>
                    </div>
                    <div class="col-md-4" id="text">
                        <!--  <textarea rows="22" cols="25" readonly = "readonly" id="Mytextarea" style="overflow-x:scroll;word-wrap:normal"></textarea> -->
                    </div>
                </div>
            </div>
            <div class="panel panel-default" style="height:250px;position:absolute;top:500px;">
                <div class="panel-body" id="Historgram">
                </div>
            </div>

        </div>
    </div>
</body>
<script type="text/javascript">
    ! function () {
        laydate.skin('molv'); //切换皮肤，请查看skins下面皮肤库
        laydate({
            elem: '#demo'
        }); //绑定元素
    }();

    //日期范围限制
    var start = {
        elem: '#start',
        format: 'YYYY-MM-DD',
        min: laydate.now(), //设定最小日期为当前日期
        max: '2099-06-16', //最大日期
        istime: true,
        istoday: false,
        choose: function (datas) {
            end.min = datas; //开始日选好后，重置结束日的最小日期
            end.start = datas //将结束日的初始值设定为开始日
        }
    };

    var end = {
        elem: '#end',
        format: 'YYYY-MM-DD',
        min: laydate.now(),
        max: '2099-06-16',
        istime: true,
        istoday: false,
        choose: function (datas) {
            start.max = datas; //结束日选好后，充值开始日的最大日期
        }
    };
    laydate(start);
    laydate(end);

    //自定义日期格式
    laydate({
        elem: '#test1',
        format: 'YYYY年MM月DD日',
        festival: true, //显示节日
        choose: function (datas) { //选择日期完毕的回调
            alert('得到：' + datas);
        }
    });

    //日期范围限定在昨天到明天
    laydate({
        elem: '#hello3',
        min: laydate.now(-1), //-1代表昨天，-2代表前天，以此类推
        max: laydate.now(+1) //+1代表明天，+2代表后天，以此类推
    });
</script>
<script src="https://d3js.org/d3-hexbin.v0.2.min.js"></script>
<script>
    var width = 350;
    var height = 300;

    var svg = d3.select("body")
        .select("#pie")
        .append("svg")
        .attr("width", width)
        .attr("height", height);

    var svg2 = d3.select("body")
        .select("#pie2")
        .append("svg")
        .attr("width", width)
        .attr("height", height);

    var svgtext = d3.select("body")
        .select("#text")
        .append("svg")
        .attr("width", 220)
        .attr("height", 450);


    var pie = d3.layout.pie()
        .sort(null)
        .value(function (d) {
            return d[0]
        });

    //var outerRadius = width / 2;    //外半径
    var innerRadius = height / 4; //内半径

    var arc = d3.svg.arc() //弧生成器
        .innerRadius(55);
</script>
<script type="text/javascript">
    //创建和初始化地图函数：
    function initMap() {
        createMap(); //创建地图
        setMapEvent(); //设置地图事件
        addMapControl(); //向地图添加控件
        //addPolyline();//向地图中添加线
        finalpoints = [];
    }

    //创建地图函数：
    function createMap() {
        var map = new BMap.Map("dituContent"); //在百度地图容器中创建一个地图
        var point = new BMap.Point(114.000424, 22.581052); //定义一个中心点坐标
        map.centerAndZoom(point, 12); //设定地图的中心点和坐标并将地图显示在地图容器中
        window.map = map; //将map变量存储在全局
    }

    //地图事件设置函数：
    function setMapEvent() {
        map.enableDragging(); //启用地图拖拽事件，默认启用(可不写)
        map.enableScrollWheelZoom(); //启用地图滚轮放大缩小
        map.enableDoubleClickZoom(); //启用鼠标双击放大，默认启用(可不写)
        map.enableKeyboard(); //启用键盘上下左右键移动地图
        //map.setMapStyle({style:'grayscale'});
    }

    //地图控件添加函数：
    function addMapControl() {
        //向地图中添加缩放控件
        // var ctrl_nav = new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_LEFT,type:BMAP_NAVIGATION_CONTROL_LARGE});
        // map.addControl(ctrl_nav);
        //向地图中添加缩略图控件
        var ctrl_ove = new BMap.OverviewMapControl({
            anchor: BMAP_ANCHOR_BOTTOM_RIGHT,
            isOpen: 1
        });
        map.addControl(ctrl_ove);
        //向地图中添加比例尺控件
        var ctrl_sca = new BMap.ScaleControl({
            anchor: BMAP_ANCHOR_BOTTOM_LEFT
        });
        map.addControl(ctrl_sca);
    }

    //标注线数组



    function load(value) {


        d3.json("data/PieData2." + value + ".json", function (error, json) {
            svg.selectAll("path").remove();
            svg.selectAll("polygon").remove();
            svg.selectAll("circle").remove();

            var arcs = svg.append("g")
                .attr("transform", "translate(0,-100)");


            var myArea = d3.svg.area()
                .x0(function (d, i) {
                    // gradienttemp.append("stop")
                    //   .attr("offset", i/json.length*100+"%")
                    //   .attr("stop-color",piecolor(d[1]) )
                    //   .attr("stop-opacity",1.0);
                    return width / 2 + Math.cos(d[0] / 86400 * 2 * Math.PI - Math.PI / 2) * (0.45 * width /
                        2 * 0.97 + d[2]);
                })
                .x1(function (d, i) {
                    return width / 2 + Math.cos(d[0] / 86400 * 2 * Math.PI - Math.PI / 2) * (0.35 * width /
                        2 * 0.97);
                })
                .y0(function (d, i) {
                    return width / 2 + Math.sin(d[0] / 86400 * 2 * Math.PI - Math.PI / 2) * (0.45 * width /
                        2 * 0.97 + d[2]);
                })
                .y1(function (d, i) {
                    return width / 2 + Math.sin(d[0] / 86400 * 2 * Math.PI - Math.PI / 2) * (0.35 * width /
                        2 * 0.97);
                })
                .interpolate("basis");

            // var gradienttemp=svg.append("defs")
            //                       .append("radialGradient")
            //                       .attr("id", "birthgradient")
            //                       .attr("x1", "0%")
            //                       .attr("y1", "0%")
            //                       .attr("x2", "100%")
            //                       .attr("y2", "0%")
            //                       .attr("spreadMethod", "pad");

            // console.log(json.length);

            // for(var j=0;j<=100;j++)
            //           {

            //               gradienttemp.append("stop")
            //                   .attr("offset", j+"%")
            //                   .attr("stop-color", "blue")
            //                   .attr("stop-opacity", 0.01*j);
            //           }



            arcs.append("path")
                .attr("d", myArea(json))
                .style("fill", color(1))
                .style("stroke", "none")
                .style("stroke-width", 1)
                .style("opacity", 0.5);

            pointerContainer = svg.append("svg:g");

            var pointer = pointerContainer.append('polygon')
                .attr({
                    points: '250,65.125 247.5,167 252.5,167'
                })
                .style({
                    fill: "#dc3912",
                    stroke: '#dc3912',
                    'stroke-width': 0.5,
                    'fill-opacity': 0.8
                });

            pointerContainer.append("svg:circle")
                .attr("cx", width / 2)
                .attr("cy", width / 2 - 100)
                .attr("r", 8)
                .style("fill", "#4684EE")
                .style("stroke", "none")
                .style("opacity", 1);



            var r = 0.35 * width / 2 * 0.97;


            d3.select("#pieinput")
                .on("input", changed);

            function changed() {
                var value = this.value;

                var x1 = getX(value);
                var y1 = getY(value);
                var x2 = getX2(value);
                var y2 = getY2(value);
                var x3 = getX3(value);
                var y3 = getY3(value);

                pointer.attr({
                    points: '' + x1 + ',' + y1 + ' ' + x2 + ',' + y2 + ' ' + x3 + ',' + y3 + ''
                })
                var myhour = parseInt(value / 3600);
                var mymintue = parseInt((value - myhour * 3600) / 60);
                var mysecond = value - myhour * 3600 - mymintue * 60;
                var span = document.getElementById('timesqan');
                if (myhour < 10)
                    myhour = "0" + myhour;
                if (mymintue < 10)
                    mymintue = "0" + mymintue;
                if (mysecond < 10)
                    mysecond = "0" + mysecond;
                span.innerHTML = myhour + ":" + mymintue + ":" + mysecond;
                console.log(span);
            }

            function getX(value) {
                return width / 2 + Math.cos(value / 86400 * 2 * Math.PI - Math.PI / 2) * r;
            }

            function getY(value) {
                return width / 2 - 100 + Math.sin(value / 86400 * 2 * Math.PI - Math.PI / 2) * r;
            }

            function getX2(value) {
                return width / 2 + Math.cos(value / 86400 * 2 * Math.PI - Math.PI / 2 - Math.PI / 18 - Math.PI) *
                    17;
            }

            function getY2(value) {
                return height / 2 + Math.sin(value / 86400 * 2 * Math.PI - Math.PI / 2 - Math.PI / 18 - Math.PI) *
                    17;
            }

            function getX3(value) {
                return width / 2 + Math.cos(value / 86400 * 2 * Math.PI - Math.PI / 2 + Math.PI / 18 - Math.PI) *
                    17;
            }

            function getY3(value) {
                return height / 2 + Math.sin(value / 86400 * 2 * Math.PI - Math.PI / 2 + Math.PI / 18 - Math.PI) *
                    17;
            }
        });

        d3.json("data/PieData." + value + ".json", function (error, json) {
            //svg.selectAll("path").remove();
            var pie = d3.layout.pie()
                .sort(null)
                .value(function (d) {
                    return d[0]
                });

            var piedata = pie(json);

            var piecolor = d3.scale.category10();

            var arc2 = d3.svg.arc() //弧生成器
                .innerRadius(0.35 * width / 2 * 0.97) //设置内半径
                .outerRadius(0.45 * width / 2 * 0.97); //设置外半径

            var arcs1 = svg.selectAll("g")
                .data(piedata)
                .enter()
                .append("g")
                .attr("transform", "translate(" + (width / 2) + ",150)");

            arcs1.append("path")
                .attr("fill", function (d) {
                    return piecolor(d.data[1]);
                })
                .transition()
                .delay(function (d, i) {
                    return i * 1;
                })
                .duration(1)
                .ease("linear")
                .attr("d", function (d) {
                    return arc2(d);
                });
        });


        // d3.json("TransformPath1.json",function(error,json)
        // {
        //     var plPoints;
        //     plPoints = json;
        //     addPolyline(plPoints);
        // });
        // initMap();
    }




    //向地图中添加线函数
    function addPolyline(plPoints) {
        var finalpoints = [];
        finalpoints = getPoints(plPoints);
        var json = plPoints[0];
        console.log(json)
        var driving = new BMap.DrivingRoute(map);
        for (var k = 0; k < finalpoints.length - 1; k++) {
            driving.search(finalpoints[k], finalpoints[k + 1]);
            driving.setSearchCompleteCallback(function () {
                var pts = driving.getResults().getPlan(0).getRoute(0).getPath();
                distance = distance + driving.getResults().getPlan(0).getRoute(0).getDistance(false);
                var line = new BMap.Polyline(pts, {
                    strokeStyle: json.style,
                    strokeWeight: json.weight,
                    strokeColor: json.color,
                    strokeOpacity: json.opacity
                });
                map.addOverlay(line);
            });
        }
    }

    // initMap();//创建和初始化地图

    var hexagoncolor = d3.interpolate(d3.rgb(0, 31, 86), d3.rgb(0, 255, 255));
    var hexagoncolorLinear = d3.scale.linear()
        .domain([5, 1])
        .range([0, 1]);

    var hexagonVcolor = d3.interpolate(d3.rgb(255, 0, 0), d3.rgb(0, 255, 255));
    var hexagonVcolorLinear = d3.scale.linear()
        .domain([0, 50])
        .range([0, 1]);

    var hexsvg = d3.select("body")
        .select("#a3") //选取要添加画布的div
        .append("svg")
        .attr("width", document.getElementById("dituContent").offsetWidth)
        .attr("height", document.getElementById("dituContent").offsetHeight)
        .append("g")
        //.call(zoom)
        .attr("transform", "translate(0,0)");

    var hexbin = d3.hexbin()
        .radius(5)
        .extent([
            [0, 0],
            [document.getElementById("dituContent").offsetWidth, document.getElementById("dituContent").offsetHeight]
        ]);

    var color = d3.scale.category10();

    var hexes;

    // d3.json("RectCenterKmeans.json",function(error,json)
    // {
    //     hexsvg.append("g").selectAll(".MyRect")
    //           .data(json)
    //           .enter()
    //           .append("rect")
    //           .attr("class","MyRect")
    //           .attr("transform","translate(0,0)")
    //           .attr("x", function(d,i){
    //             return d[0]*2;
    //           } )
    //           .attr("y",function(d){
    //             return d[1]*2;
    //           })
    //           .attr("width", 2 )
    //           .attr("height", 2)
    //           .attr("fill", function(d) 
    //           {
    //             return color(d[3]);
    //           })
    //           .style("opacity",0.8);
    // });



    d3.json("data/RectCenterArea2.json", function (error, json) {
        var myAreaRect = d3.svg.line()
            .x(function (d, i) {
                return d[0];
            })
            .y(function (d, i) {
                return d[1];
            })
            .interpolate("linear-closed");

        hexsvg.append("g")
            .selectAll(".MyArea")
            .data(json)
            .enter()
            .append("path")
            .attr("class", function (d, i) {
                return "MyArea" + d[0];
            })
            .attr("id", function (d, i) {
                return "AreaNum" + i;
            })
            .attr("d", function (d, i) {
                //console.log(d);
                return myAreaRect(d[1]);
            })
            .style("fill", function (d, i) {
                return color(d[0]);
            })
            .style("stroke", d3.rgb(0, 0, 0))
            .style("stroke-width", 0.0)
            .style("opacity", 0.3)
            .attr("transform", "translate(0,0)")
            .on("mouseover", function (d, i) {
                d3.select(this)
                    .transition()
                    .duration(100)
                    .style("opacity", 1.0);
            })
            .on("mouseout", function (d, i) {
                d3.select(this)
                    .transition()
                    .duration(150)
                    .style("opacity", 0.3);
            })
            .on("mousedown", function (d, i) {
                d3.json("data/RectCenterV." + i + ".json", function (error, colorV) {
                    d3.json("data/SinglePointData." + i + ".json", function (error, json) {
                        var pieSc = d3.scale.linear()
                            .domain([0, 50])
                            .range([0, 1]);
                        var pieSc2 = d3.scale.linear()
                            .domain([0, 400])
                            .range([1, 50]);

                        svg.selectAll(".MyPie").remove();
                        var pie = d3.layout.pie()
                            .sort(null)
                            .value(function (d) {
                                return 1
                            });

                        var piedata = pie(json[0]);

                        var piedata2 = pie(json[1]);

                        var piecolor = d3.interpolate(d3.rgb(255, 0, 0), d3.rgb(0, 255, 255));

                        var arc2 = d3.svg.arc() //弧生成器
                            .innerRadius(95) //设置内半径
                            .outerRadius(95); //设置外半径

                        var arcs2 = svg.append("g")
                            .selectAll(".MyPie")
                            .data(piedata)
                            .enter()
                            .append("path")
                            .attr("class", "MyPie")
                            .attr("transform", "translate(" + (width / 2) + ",150)")
                            .attr("fill", function (d, i) {
                                return piecolor(pieSc(colorV[i]));
                            })
                            .transition()
                            .delay(function (d, i) {
                                return i * 10;
                            })
                            .duration(1)
                            .ease("linear")
                            .attr("d", function (d) {
                                arc2
                                    .innerRadius(95)
                                    .outerRadius(100 + pieSc2(d.data));
                                return arc2(d);
                            });

                        var arcs3 = svg.append("g")
                            .selectAll(".MyPie")
                            .data(piedata2)
                            .enter()
                            .append("path")
                            .attr("class", "MyPie")
                            .attr("transform", "translate(" + (width / 2) + ",150)")
                            .attr("fill", function (d, i) {
                                return piecolor(pieSc(colorV[i]));
                            })
                            .transition()
                            .delay(function (d, i) {
                                return i * 10;
                            })
                            .duration(1)
                            .ease("linear")
                            .attr("d", function (d) {
                                console.log(d);
                                arc2.innerRadius(89 - pieSc2(d.data))
                                    .outerRadius(94);
                                return arc2(d);
                            });
                    });

                    d3.json("data/KmeansAvg." + d[0] + ".json", function (error, json) {
                        svg.selectAll(".MyLine").remove();
                        var pieSc2 = d3.scale.linear()
                            .domain([0, 400])
                            .range([1, 50]);

                        var arcs = svg.append("g");


                        var myArea = d3.svg.line()
                            .x(function (d, i) {
                                return Math.cos(i * 600 / 86400 * 2 * Math.PI - Math.PI /
                                    2) * (100 + pieSc2(d[0]));
                            })
                            .y(function (d, i) {
                                return Math.sin(i * 600 / 86400 * 2 * Math.PI - Math.PI /
                                    2) * (100 + pieSc2(d[0]));
                            })
                            .interpolate("linear-closed");

                        var myArea2 = d3.svg.line()
                            .x(function (d, i) {
                                return Math.cos(i * 600 / 86400 * 2 * Math.PI - Math.PI /
                                    2) * (89 - pieSc2(d[1]));
                            })
                            .y(function (d, i) {
                                return Math.sin(i * 600 / 86400 * 2 * Math.PI - Math.PI /
                                    2) * (89 - pieSc2(d[1]));
                            })
                            .interpolate("linear-closed");

                        arcs.append("path")
                            .attr("class", "MyLine")
                            .attr("d", myArea(json))
                            .style("fill", "none")
                            .style("stroke", d3.rgb(0, 0, 255))
                            .style("stroke-width", 2)
                            .style("opacity", 0.6)
                            .attr("transform", "translate(" + (width / 2) + ",150)");

                        arcs.append("path")
                            .attr("class", "MyLine")
                            .attr("d", myArea2(json))
                            .style("fill", "none")
                            .style("stroke", d3.rgb(0, 0, 255))
                            .style("stroke-width", 2)
                            .style("opacity", 0.6)
                            .attr("transform", "translate(" + (width / 2) + ",150)");
                    });

                });
            });

        // hexsvg.append("path")
        //   .attr("class","MyArea")
        //   .attr("d",myAreaRect(json[1]))
        //   .style("fill", d3.rgb(0,0,255))
        //   .style("stroke",d3.rgb(0,0,255))
        //   .style("stroke-width",2)
        //   .style("opacity",0.6)
        //   .attr("transform","translate(0,0)");

        // hexsvg.append("g").selectAll(".MyRect")
        //       .data(json)
        //       .enter()
        //       .append("rect")
        //       .attr("class","MyRect")
        //       .attr("transform","translate(0,0)")
        //       .attr("x", function(d,i){
        //         return d[0]*2;
        //       } )
        //       .attr("y",function(d){
        //         return d[1]*2;
        //       })
        //       .attr("width", 2 )
        //       .attr("height", 2)
        //       .attr("fill", function(d) 
        //       {
        //         return color(d[3]);
        //       })
        //       .style("opacity",0.8);
    });

    // d3.json("PostionData.1.json",function(error,json)
    //     {

    //       hexes = hexsvg.append("g")
    //      .attr("class", "hexagon2")
    //      .attr("clip-path", "url(#clip)")
    //      .selectAll("path")
    //      .data(json)
    //      .enter()
    //      .append("path")
    //      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
    //      .attr("d", hexbin.hexagon())
    //      .attr("fill", "none");

    //     hexes = hexsvg.append("g")
    //      .attr("class", "hexagon")
    //      .attr("clip-path", "url(#clip)")
    //      .selectAll("path")
    //      .data(json)
    //      .enter()
    //      .append("path")
    //      .on("mouseover",function(d,i){
    //          d3.select(this)
    //          .transition()
    //          //.attr("fill","rgba(0,0,255,0.5)")
    //          .attr("d", hexbin.hexagon(8));

    //         })
    //         .on("mouseout",function(d,i){
    //             d3.select(this)
    //             .transition()
    //             //.attr("fill","rgba(0,0,255,0.0)")
    //             .attr("d", hexbin.hexagon(5));
    //         })
    //      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
    //      .attr("d", hexbin.hexagon())
    //      .attr("fill", function(d) 
    //       {
    //         // if(d.num == 0)
    //         //     return "none";
    //         // else
    //             return hexagoncolor(hexagoncolorLinear(d.num));
    //       })
    //      .style("opacity",function(d){
    //         if (d.num==0) 
    //             return 0;
    //      });
    //                   // .on("mousedown",function(d,i){

    //                   //                    hexsvg.select(".hexagon2").remove();

    //                   //                    hexsvg.append("g")
    //                   //                      .attr("class", "hexagon2")
    //                   //                      .attr("clip-path", "url(#clip)")
    //                   //                      .selectAll("path")
    //                   //                      .data(d.point)
    //                   //                      .enter()
    //                   //                      .append("path")
    //                   //                      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
    //                   //                      .attr("fill",function(d,i) { return color(i); })
    //                   //                      .transition()
    //                   //                      .delay(function(d,i){ return i * 800; })
    //                   //                      .duration(200)
    //                   //                      .ease("linear")
    //                   //                      .attr("d", hexbin.hexagon(1))
    //                   //                      .transition()
    //                   //                      .duration(400)
    //                   //                      .attr("d", hexbin.hexagon(10))
    //                   //                      .transition()
    //                   //                      .duration(200)
    //                   //                      .attr("d", hexbin.hexagon(5));

    //                   //                     });
    //                   console.log(hexes);
    //     });

    d3.selectAll("input")
        .on("change", changedradio);

    function changedradio() {
        var value = this.value;

        if (value == "v") {
            hexes
                .transition()
                .duration(1000)
                .ease("linear")
                .attr("fill", function (d) {
                    if (d.num == 0)
                        return "rgba(0,0,255,0.0)";
                    else
                        return hexagonVcolor(hexagonVcolorLinear(d.v));
                });

            d3.select("#mapinput")
                .on("input", changedmapV);
        } else if (value == "num") {
            hexes
                .transition()
                .duration(1000)
                .ease("linear")
                .attr("fill", function (d) {
                    if (d.num == 0)
                        return "rgba(0,0,255,0.0)";
                    else
                        return hexagoncolor(hexagoncolorLinear(d.num));
                });

            d3.select("#mapinput")
                .on("input", changedmapNum);
        }
    }

    d3.select("#mapinput")
        .on("input", changedmapNum);

    function changedmapNum() {
        var value = this.value;
        // hexsvg.select(".hexagon2").remove();
        // hexsvg.select(".hexagon").remove();


        d3.json("data/PostionData." + value + ".json", function (error, json) {
            var datahex = json;
            hexes
                .data(datahex)
                .transition()
                .duration(500)
                .style("opacity", function (d) {
                    if (d.num == 0)
                        return 0;
                })
                .attr("fill", function (d) {
                    return hexagoncolor(hexagoncolorLinear(d.num));
                });
            //               // .on("mousedown",function(d,i){

            //               //                    hexsvg.select(".hexagon2").remove();

            //               //                    hexsvg.append("g")
            //               //                      .attr("class", "hexagon2")
            //               //                      .attr("clip-path", "url(#clip)")
            //               //                      .selectAll("path")
            //               //                      .data(d.point)
            //               //                      .enter()
            //               //                      .append("path")
            //               //                      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
            //               //                      .attr("fill",function(d,i) { return color(i); })
            //               //                      .transition()
            //               //                      .delay(function(d,i){ return i * 800; })
            //               //                      .duration(200)
            //               //                      .ease("linear")
            //               //                      .attr("d", hexbin.hexagon(1))
            //               //                      .transition()
            //               //                      .duration(400)
            //               //                      .attr("d", hexbin.hexagon(10))
            //               //                      .transition()
            //               //                      .duration(200)
            //               //                      .attr("d", hexbin.hexagon(5));

            //               //                     });
            console.log(hexes);
        });

    }

    function changedmapV() {
        var value = this.value;
        // hexsvg.select(".hexagon2").remove();
        // hexsvg.select(".hexagon").remove();


        d3.json("data/PostionData." + value + ".json", function (error, json) {
            var datahex = json;
            hexes
                .data(datahex)
                .transition()
                .duration(500)
                .style("opacity", function (d) {
                    if (d.num == 0)
                        return 0;
                })
                .attr("fill", function (d) {
                    return hexagonVcolor(hexagonVcolorLinear(d.v));
                });
            //               // .on("mousedown",function(d,i){

            //               //                    hexsvg.select(".hexagon2").remove();

            //               //                    hexsvg.append("g")
            //               //                      .attr("class", "hexagon2")
            //               //                      .attr("clip-path", "url(#clip)")
            //               //                      .selectAll("path")
            //               //                      .data(d.point)
            //               //                      .enter()
            //               //                      .append("path")
            //               //                      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
            //               //                      .attr("fill",function(d,i) { return color(i); })
            //               //                      .transition()
            //               //                      .delay(function(d,i){ return i * 800; })
            //               //                      .duration(200)
            //               //                      .ease("linear")
            //               //                      .attr("d", hexbin.hexagon(1))
            //               //                      .transition()
            //               //                      .duration(400)
            //               //                      .attr("d", hexbin.hexagon(10))
            //               //                      .transition()
            //               //                      .duration(200)
            //               //                      .attr("d", hexbin.hexagon(5));

            //               //                     });
            console.log(hexes);
        });

    }
</script>

<script>
    var widthf = 440,
        heightf = 440,
        radiusf = 6;

    var fill = d3.scale.category20();

    var force = d3.layout.force()
        .gravity(.05)
        .charge(-240)
        .linkDistance(80)
        .size([widthf, heightf]);

    var svgf = d3.select("body")
        .select("#foce")
        .append("svg")
        .attr("width", widthf)
        .attr("height", heightf);

    function changedThresholdRadio(value) {
        var mark = 0;
        svgf.selectAll("line").remove();
        svgf.selectAll("circle").remove();
        d3.json("data/FoceData10(" + value + ").json", function (error, graph) {
            if (error) throw error;

            var link = svgf.selectAll("line")
                .data(graph.links)
                .enter()
                .append("line")
                .attr("stroke-width", function (d, i) {
                    return d.value / 1000 + 1;
                })
                .attr("stroke", "#999")
                .style("opacity", function (d, i) {
                    return 0.3 + d.value / 200 * 0.7;
                })
                .on("mouseover", function (d, i) {
                    d3.select(this)
                        .transition()
                        .duration(50)
                        .attr("stroke-width", 5);
                })
                .on("mousedown", function (d, i) {
                    console.log(d)
                    d3.json("data/LineData2." + d.source.name + "." + d.target.name + ".json", function (
                        error,
                        json) {
                        svgHistorgram.selectAll(".MyRect").remove();
                        d3.select(".MyArea" + d.source.name)
                            .transition()
                            .duration(100)
                            .style("opacity", 1.0);

                        d3.select(".MyArea" + d.target.name)
                            .transition()
                            .duration(100)
                            .style("opacity", 1.0);


                        var Historgramcolor = d3.interpolate(d3.rgb(255, 0, 0), d3.rgb(0, 255, 255));
                        var HistorgramcolorLinear = d3.scale.linear()
                            .domain([15, 40])
                            .range([0, 1]);

                        var colorText = d3.scale.category20();
                        var padding = {
                            left: 30,
                            right: 30,
                            top: 20,
                            bottom: 10
                        };

                        var xScale = d3.scale.ordinal()
                            .domain(d3.range(25))
                            .rangeRoundBands([0, 675 - padding.left - padding.right]);

                        //y轴的比例尺
                        var yScale = d3.scale.linear()
                            .domain([0, d3.max(json[0])])
                            .range([50, 0]);

                        var yScale2 = d3.scale.linear()
                            .domain([0, d3.max(json[1])])
                            .range([0, 50]);



                        var rectPadding = 1;


                        var rects1 = svgHistorgram
                            .append("g").selectAll(".MyRect")
                            .data(json[0])
                            .enter()
                            .append("rect")
                            .attr("class", "MyRect")
                            .attr("transform", "translate(" + padding.left + "," + padding.top +
                                ")")
                            .attr("x", function (d, i) {
                                return xScale1(i) + rectPadding / 2;
                            })
                            .attr("y", function (d) {
                                return yScale(d) + 30;
                            })
                            .attr("width", xScale1.rangeBand() - rectPadding)
                            .attr("height", function (d) {
                                return 50 - yScale(d);
                            })
                            .attr("fill", d3.rgb(255, 0, 0))
                            .style("opacity", 0.8)
                            .on("mouseover", function (d, i) {

                                tooltip.html("乘客数为" + d + "<br/>")
                                    .style("left", (d3.event.pageX) + "px")
                                    .style("top", (d3.event.pageY + 20) + "px")
                                    .style("opacity", 1.0);
                                tooltip.style("box-shadow", "10px 0px 0px" + Historgramcolor(
                                    HistorgramcolorLinear(d))); //在提示框后添加阴影  
                            })
                            .on("mousemove", function (d) {
                                /* 鼠标移动时，更改样式 left 和 top 来改变提示框的位置 */
                                tooltip.style("left", (d3.event.pageX) + "px")
                                    .style("top", (d3.event.pageY + 20) + "px");
                            })
                            .on("mouseout", function (d, i) {
                                //鼠标移除 透明度设为0 
                                // d3.select(this)
                                // .transition()
                                // .duration(100)
                                // .attr("width", xScale1.rangeBand() - rectPadding)
                                // .attr("x", xScale1(i) + rectPadding/2)    
                                tooltip.style("opacity", 0.0);
                            });

                        var rects3 = svgHistorgram
                            .append("g").selectAll(".MyRect")
                            .data(json[2])
                            .enter()
                            .append("rect")
                            .attr("class", "MyRect")
                            .attr("transform", "translate(" + padding.left + "," + padding.top +
                                ")")
                            .attr("x", function (d, i) {
                                return xScale1(i) + rectPadding / 2;
                            })
                            .attr("y", function (d) {
                                return yScale(d) + 30;
                            })
                            .attr("width", xScale1.rangeBand() - rectPadding)
                            .attr("height", function (d) {
                                return 50 - yScale(d);
                            })
                            .attr("fill", d3.rgb(0, 255, 255))
                            .style("opacity", 0.5)
                            .on("mouseover", function (d, i) {

                                tooltip.html("乘客数为" + d + "<br/>")
                                    .style("left", (d3.event.pageX) + "px")
                                    .style("top", (d3.event.pageY + 20) + "px")
                                    .style("opacity", 1.0);
                                tooltip.style("box-shadow", "10px 0px 0px" + Historgramcolor(
                                    HistorgramcolorLinear(d))); //在提示框后添加阴影  
                            })
                            .on("mousemove", function (d) {
                                /* 鼠标移动时，更改样式 left 和 top 来改变提示框的位置 */
                                tooltip.style("left", (d3.event.pageX) + "px")
                                    .style("top", (d3.event.pageY + 20) + "px");
                            })
                            .on("mouseout", function (d, i) {
                                //鼠标移除 透明度设为0 
                                // d3.select(this)
                                // .transition()
                                // .duration(100)
                                // .attr("width", xScale1.rangeBand() - rectPadding)
                                // .attr("x", xScale1(i) + rectPadding/2)    
                                tooltip.style("opacity", 0.0);
                            });

                        var rects2 = svgHistorgram
                            .append("g").selectAll(".MyRect")
                            .data(json[1])
                            .enter()
                            .append("rect")
                            .attr("class", "MyRect")
                            .attr("transform", "translate(" + padding.left + "," + padding.top +
                                ")")
                            .attr("x", function (d, i) {
                                return xScale1(i) + rectPadding / 2;
                            })
                            .attr("y", function (d) {
                                return 57 + 30 + 14;
                            })
                            .attr("width", xScale1.rangeBand() - rectPadding)
                            // .attr("height",0)
                            // .transition()
                            // .duration(200)
                            // .ease("linear")
                            .attr("height", function (d) {
                                return yScale2(d);
                            })
                            .attr("fill", d3.rgb(255, 0, 0))
                            .style("opacity", 0.8)
                            .on("mouseover", function (d, i) {

                                tooltip.html("乘客数为" + d + "<br/>")
                                    .style("left", (d3.event.pageX) + "px")
                                    .style("top", (d3.event.pageY + 20) + "px")
                                    .style("opacity", 1.0);
                                tooltip.style("box-shadow", "10px 0px 0px" + Historgramcolor(
                                    HistorgramcolorLinear(d))); //在提示框后添加阴影  
                            })
                            .on("mousemove", function (d) {
                                /* 鼠标移动时，更改样式 left 和 top 来改变提示框的位置 */
                                tooltip.style("left", (d3.event.pageX) + "px")
                                    .style("top", (d3.event.pageY + 20) + "px");
                            })
                            .on("mouseout", function (d, i) {
                                //鼠标移除 透明度设为0 
                                // d3.select(this)
                                // .transition()
                                // .duration(100)
                                // .attr("width", xScale1.rangeBand() - rectPadding)
                                // .attr("x", xScale1(i) + rectPadding/2)    
                                tooltip.style("opacity", 0.0);
                            });

                        var rects4 = svgHistorgram
                            .append("g").selectAll(".MyRect")
                            .data(json[3])
                            .enter()
                            .append("rect")
                            .attr("class", "MyRect")
                            .attr("transform", "translate(" + padding.left + "," + padding.top +
                                ")")
                            .attr("x", function (d, i) {
                                return xScale1(i) + rectPadding / 2;
                            })
                            .attr("y", function (d) {
                                return 57 + 30 + 14;
                            })
                            .attr("width", xScale1.rangeBand() - rectPadding)
                            .attr("height", 0)
                            .transition()
                            .duration(200)
                            .ease("linear")
                            .attr("height", function (d) {
                                return yScale2(d);
                            })
                            .attr("fill", d3.rgb(0, 255, 255))
                            .style("opacity", 0.5)
                            .on("mouseover", function (d, i) {


                                tooltip.html("乘客数为" + d + "<br/>")
                                    .style("left", (d3.event.pageX) + "px")
                                    .style("top", (d3.event.pageY + 20) + "px")
                                    .style("opacity", 1.0);
                                tooltip.style("box-shadow", "10px 0px 0px" + Historgramcolor(
                                    HistorgramcolorLinear(d))); //在提示框后添加阴影  
                            })
                            .on("mousemove", function (d) {
                                /* 鼠标移动时，更改样式 left 和 top 来改变提示框的位置 */
                                tooltip.style("left", (d3.event.pageX) + "px")
                                    .style("top", (d3.event.pageY + 20) + "px");
                            })
                            .on("mouseout", function (d, i) {
                                //鼠标移除 透明度设为0 
                                // d3.select(this)
                                // .transition()
                                // .duration(100)
                                // .attr("width", xScale1.rangeBand() - rectPadding)
                                // .attr("x", xScale1(i) + rectPadding/2)    
                                tooltip.style("opacity", 0.0);
                            });
                    });
                })
                .on("mouseout", function (d, i) {
                    d3.select(this)
                        .transition()
                        .duration(300)
                        .attr("stroke-width", function (d, i) {
                            return d.value / 1000 + 1;;
                        })
                });

            var node = svgf.selectAll("circle")
                .data(graph.nodes)
                .enter().append("circle")
                .attr("r", function (d, i) {
                    return d.value / 3000 + 5;
                })
                .style("fill", function (d) {
                    return color(d.color);
                })
                .style("stroke", function (d) {
                    return d3.rgb(255, 255, 255);
                })
                .attr("class", function (d, i) {
                    return "MyCircle" + d.color;
                })
                .call(force.drag)
                .on("mouseover", function (d, i) {
                    d3.select(this)
                        .transition()
                        .duration(50)
                        .attr("r", 25);

                    d3.select("#AreaNum" + d.name)
                        .transition()
                        .duration(100)
                        .style("opacity", 1.0);
                })
                .on("mouseout", function (d, i) {
                    d3.select(this)
                        .transition()
                        .duration(300)
                        .attr("r", function (d, i) {
                            return d.value / 3000 + 5;
                        })
                    if (mark == 0) {
                        d3.select("#AreaNum" + d.name)
                            .transition()
                            .duration(100)
                            .style("opacity", 0.3);
                    }
                    mark = 0;
                })
                .on("mousedown", function (d, i) {
                    d3.json("data/taxinum.json", function (error, json) {
                        TextRect = svgtext.append("g")
                            .selectAll(".TextRect")
                            .data(json)
                            .enter()
                            .append("g")
                            .attr("transform", "translate(0,0)")

                        // .attr("fill",function() { //填充颜色
                        //     let color = ["#20a0ff","#F59DA6","#FBD0A1","#1ab394"];
                        //     return color[Math.floor(Math.random() * color.length)];
                        // })
                        //console.log(json);
                        TextRect.append("rect")
                            .attr("class", "TextRect")
                            .attr("x", 0)
                            .attr("y", function (d, i) { //每个矩形的起始y坐标
                                return i * 40 + 10;
                            })
                            .attr("width", 150)
                            .attr("height", 35) //每个矩形的高度
                            .attr("rx", 10)
                            .style("fill", "#20a0ff")
                        TextRect.append("text")
                            .text(function (d) {
                                return d;
                            })
                            .attr("text-anchor", "middle")
                            .style("fill", "white")
                            .style("font-size", "15px")
                            .attr("x", function (d, i) {
                                return 0 + 75;
                            })
                            .attr("y", function (d, i) {
                                return i * 40 + 10 + 25;
                            })



                    });



                    mark = 1;
                    d3.selectAll("line")
                        .transition()
                        .duration(50)
                        .style("opacity", 0.3);

                    d3.selectAll(".KLine" + d.color + d.color)
                        .transition()
                        .duration(100)
                        .attr("stroke", d3.rgb(0, 0, 0))
                        .style("opacity", 1.0);

                    d3.selectAll("circle")
                        .transition()
                        .duration(50)
                        .style("opacity", 0.5);

                    d3.selectAll(".MyCircle" + d.color)
                        .transition()
                        .duration(100)
                        .style("opacity", 1.0);

                    d3.selectAll(".MyArea" + d.color)
                        .transition()
                        .duration(100)
                        .style("opacity", 1.0);

                    d3.json("data/RectCenterV." + d.name + ".json", function (error, colorV) {
                        d3.json("data/SinglePointData." + d.name + ".json", function (error, json) {
                            var pieSc = d3.scale.linear()
                                .domain([0, 50])
                                .range([0, 1]);
                            var pieSc2 = d3.scale.linear()
                                .domain([0, 400])
                                .range([1, 50]);



                            svg.selectAll(".MyPie").remove();
                            var pie = d3.layout.pie()
                                .sort(null)
                                .value(function (d) {
                                    return 1
                                });

                            var piedata = pie(json[0]);

                            var piedata2 = pie(json[1]);

                            var piecolor = d3.interpolate(d3.rgb(255, 0, 0), d3.rgb(0, 255,
                                255));

                            var arc2 = d3.svg.arc() //弧生成器
                                .innerRadius(95) //设置内半径
                                .outerRadius(95); //设置外半径

                            var arcs2 = svg.append("g")
                                .selectAll(".MyPie")
                                .data(piedata)
                                .enter()
                                .append("path")
                                .attr("class", "MyPie")
                                .attr("transform", "translate(" + (width / 2) + ",150)")
                                .attr("fill", function (d, i) {
                                    return piecolor(pieSc(colorV[i]));
                                })
                                .attr("d", function (d) {
                                    arc2
                                        .innerRadius(95)
                                        .outerRadius(100 + pieSc2(d.data));
                                    return arc2(d);
                                });

                            var arcs3 = svg.append("g")
                                .selectAll(".MyPie")
                                .data(piedata2)
                                .enter()
                                .append("path")
                                .attr("class", "MyPie")
                                .attr("transform", "translate(" + (width / 2) + ",150)")
                                .attr("fill", function (d, i) {
                                    return piecolor(pieSc(colorV[i]));
                                })
                                .attr("d", function (d) {
                                    arc2.innerRadius(89 - pieSc2(d.data))
                                        .outerRadius(94);
                                    return arc2(d);
                                });
                        });

                        d3.json("data/KmeansAvg." + d.color + ".json", function (error, json) {
                            console.log(json)
                            svg.selectAll(".MyLine").remove();
                            svg2.selectAll(".MyLine").remove();
                            var pieSc2 = d3.scale.linear()
                                .domain([0, 400])
                                .range([1, 50]);

                            var pieSc3 = d3.scale.linear()
                                .domain([0, 400])
                                .range([1, 50]);

                            var arcAvg = svg2.append("g")
                                .selectAll(".MyLine")
                                .data(json)
                                .enter()
                                .append("line")
                                .attr("x1", function (d, i) {
                                    if (i % 6 == 0.0)
                                        return Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (100 + pieSc3(d[0])) - 6 *
                                            Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .attr("y1", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (100 + pieSc3(d[0])) - 6 *
                                            Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .attr("x2", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (100 + pieSc3(d[0])) + 6 *
                                            Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .attr("y2", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (100 + pieSc3(d[0])) + 6 *
                                            Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .style("fill", "none")
                                .style("stroke", d3.rgb(0, 0, 0))
                                .style("stroke-width", 1.5)
                                .attr("transform", "translate(" + (width / 2) + ",150)")

                            svg2.append("g")
                                .selectAll(".MyLine")
                                .data(json)
                                .enter()
                                .append("line")
                                .attr("x1", function (d, i) {
                                    if (i % 6 == 0.0)
                                        return Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (89 - pieSc3(d[1])) - 6 *
                                            Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .attr("y1", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (89 - pieSc3(d[1])) - 6 *
                                            Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .attr("x2", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (89 - pieSc3(d[1])) + 6 *
                                            Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .attr("y2", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (89 - pieSc3(d[1])) + 6 *
                                            Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .style("fill", "none")
                                .style("stroke", d3.rgb(0, 0, 0))
                                .style("stroke-width", 1.5)
                                .attr("transform", "translate(" + (width / 2) + ",150)");

                            svg2.append("g")
                                .selectAll(".MyLine")
                                .data(json)
                                .enter()
                                .append("line")
                                .attr("x1", function (d, i) {
                                    if (i % 6 == 0.0)
                                        return Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (100 + pieSc3(d[2])) - 4 *
                                            Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .attr("y1", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (100 + pieSc3(d[2])) - 4 *
                                            Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .attr("x2", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (100 + pieSc3(d[2])) + 4 *
                                            Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .attr("y2", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (100 + pieSc3(d[2])) + 4 *
                                            Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .style("fill", "none")
                                .style("stroke", d3.rgb(0, 0, 255))
                                .style("stroke-width", 1)
                                .attr("transform", "translate(" + (width / 2) + ",150)")

                            svg2.append("g")
                                .selectAll(".MyLine")
                                .data(json)
                                .enter()
                                .append("line")
                                .attr("x1", function (d, i) {
                                    if (i % 6 == 0.0)
                                        return Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (89 - pieSc3(d[3])) - 4 *
                                            Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .attr("y1", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (89 - pieSc3(d[3])) - 4 *
                                            Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .attr("x2", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (89 - pieSc3(d[3])) + 4 *
                                            Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .attr("y2", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (89 - pieSc3(d[3])) + 4 *
                                            Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .style("fill", "none")
                                .style("stroke", d3.rgb(0, 0, 255))
                                .style("stroke-width", 1)
                                .attr("transform", "translate(" + (width / 2) + ",150)");

                            svg2.append("g")
                                .selectAll(".MyLine")
                                .data(json)
                                .enter()
                                .append("line")
                                .attr("x1", function (d, i) {
                                    if (i % 6 == 0.0)
                                        return Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (100 + pieSc3(d[4])) - 4 *
                                            Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .attr("y1", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (100 + pieSc3(d[4])) - 4 *
                                            Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .attr("x2", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (100 + pieSc3(d[4])) + 4 *
                                            Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .attr("y2", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (100 + pieSc3(d[4])) + 4 *
                                            Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .style("fill", "none")
                                .style("stroke", d3.rgb(0, 0, 255))
                                .style("stroke-width", 1)
                                .attr("transform", "translate(" + (width / 2) + ",150)")

                            svg2.append("g")
                                .selectAll(".MyLine")
                                .data(json)
                                .enter()
                                .append("line")
                                .attr("x1", function (d, i) {
                                    if (i % 6 == 0.0)
                                        return Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (89 - pieSc3(d[5])) - 4 *
                                            Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .attr("y1", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (89 - pieSc3(d[5])) - 4 *
                                            Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .attr("x2", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (89 - pieSc3(d[5])) + 4 *
                                            Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .attr("y2", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI / 2) * (89 - pieSc3(d[5])) + 4 *
                                            Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                                Math.PI)
                                })
                                .style("fill", "none")
                                .style("stroke", d3.rgb(0, 0, 255))
                                .style("stroke-width", 1)
                                .attr("transform", "translate(" + (width / 2) + ",150)");

                            svg2.append("g")
                                .selectAll(".MyLine")
                                .data(json)
                                .enter()
                                .append("polygon")
                                .attr("points", function (d, i) {
                                    if (i % 6 == 0.0) {
                                        var x1 = Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (100 + pieSc3(d[4] + (d[
                                            2] - d[4]) * 1 / 4)) - 6 * Math.cos(i *
                                            600 / 86400 * 2 * Math.PI - Math.PI)
                                        var y1 = Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (100 + pieSc3(d[4] + (d[
                                            2] - d[4]) * 1 / 4)) - 6 * Math.sin(i *
                                            600 / 86400 * 2 * Math.PI - Math.PI)
                                        var x2 = Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (100 + pieSc3(d[4] + (d[
                                            2] - d[4]) * 1 / 4)) + 6 * Math.cos(i *
                                            600 / 86400 * 2 * Math.PI - Math.PI)
                                        var y2 = Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (100 + pieSc3(d[4] + (d[
                                            2] - d[4]) * 1 / 4)) + 6 * Math.sin(i *
                                            600 / 86400 * 2 * Math.PI - Math.PI)
                                        var x3 = Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (100 + pieSc3(d[4] + (d[
                                            2] - d[4]) * 3 / 4)) - 6 * Math.cos(i *
                                            600 / 86400 * 2 * Math.PI - Math.PI)
                                        var y3 = Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (100 + pieSc3(d[4] + (d[
                                            2] - d[4]) * 3 / 4)) - 6 * Math.sin(i *
                                            600 / 86400 * 2 * Math.PI - Math.PI)
                                        var x4 = Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (100 + pieSc3(d[4] + (d[
                                            2] - d[4]) * 3 / 4)) + 6 * Math.cos(i *
                                            600 / 86400 * 2 * Math.PI - Math.PI)
                                        var y4 = Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (100 + pieSc3(d[4] + (d[
                                            2] - d[4]) * 3 / 4)) + 6 * Math.sin(i *
                                            600 / 86400 * 2 * Math.PI - Math.PI)
                                        return "" + x1 + "," + y1 + " " + x2 + "," + y2 +
                                            " " + x4 + "," + y4 + " " + x3 + "," + y3 +
                                            ""
                                    }
                                })
                                .style("fill", "none")
                                .style("stroke", d3.rgb(0, 0, 255))
                                .style("stroke-width", 1)
                                .attr("transform", "translate(" + (width / 2) + ",150)")

                            svg2.append("g")
                                .selectAll(".MyLine")
                                .data(json)
                                .enter()
                                .append("polygon")
                                .attr("points", function (d, i) {
                                    if (i % 6 == 0.0) {
                                        var x1 = Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (89 - pieSc3(d[5] + (d[3] -
                                            d[5]) * 1 / 4)) - 6 * Math.cos(i * 600 /
                                            86400 * 2 * Math.PI - Math.PI)
                                        var y1 = Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (89 - pieSc3(d[5] + (d[3] -
                                            d[5]) * 1 / 4)) - 6 * Math.sin(i * 600 /
                                            86400 * 2 * Math.PI - Math.PI)
                                        var x2 = Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (89 - pieSc3(d[5] + (d[3] -
                                            d[5]) * 1 / 4)) + 6 * Math.cos(i * 600 /
                                            86400 * 2 * Math.PI - Math.PI)
                                        var y2 = Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (89 - pieSc3(d[5] + (d[3] -
                                            d[5]) * 1 / 4)) + 6 * Math.sin(i * 600 /
                                            86400 * 2 * Math.PI - Math.PI)
                                        var x3 = Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (89 - pieSc3(d[5] + (d[3] -
                                            d[5]) * 3 / 4)) - 6 * Math.cos(i * 600 /
                                            86400 * 2 * Math.PI - Math.PI)
                                        var y3 = Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (89 - pieSc3(d[5] + (d[3] -
                                            d[5]) * 3 / 4)) - 6 * Math.sin(i * 600 /
                                            86400 * 2 * Math.PI - Math.PI)
                                        var x4 = Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (89 - pieSc3(d[5] + (d[3] -
                                            d[5]) * 3 / 4)) + 6 * Math.cos(i * 600 /
                                            86400 * 2 * Math.PI - Math.PI)
                                        var y4 = Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (89 - pieSc3(d[5] + (d[3] -
                                            d[5]) * 3 / 4)) + 6 * Math.sin(i * 600 /
                                            86400 * 2 * Math.PI - Math.PI)
                                        return "" + x1 + "," + y1 + " " + x2 + "," + y2 +
                                            " " + x4 + "," + y4 + " " + x3 + "," + y3 +
                                            ""
                                    }
                                })
                                .style("fill", "none")
                                .style("stroke", d3.rgb(0, 0, 255))
                                .style("stroke-width", 1)
                                .attr("transform", "translate(" + (width / 2) + ",150)")

                            svg2.append("g")
                                .selectAll(".MyLine")
                                .data(json)
                                .enter()
                                .append("line")
                                .attr("x1", function (d, i) {
                                    if (i % 6 == 0.0)
                                        return Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (100 + pieSc3(d[2]))
                                })
                                .attr("y1", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (100 + pieSc3(d[2]))
                                })
                                .attr("x2", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (100 + pieSc3(d[4]))
                                })
                                .attr("y2", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (100 + pieSc3(d[4]))
                                })
                                .style("fill", "none")
                                .style("stroke", d3.rgb(0, 0, 255))
                                .style("stroke-width", 1)
                                .attr("transform", "translate(" + (width / 2) + ",150)")

                            svg2.append("g")
                                .selectAll(".MyLine")
                                .data(json)
                                .enter()
                                .append("line")
                                .attr("x1", function (d, i) {
                                    if (i % 6 == 0.0)
                                        return Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (89 - pieSc3(d[3]))
                                })
                                .attr("y1", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (89 - pieSc3(d[3]))
                                })
                                .attr("x2", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (89 - pieSc3(d[5]))
                                })
                                .attr("y2", function (d, i) {
                                    if (i % 6 == 0)
                                        return Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                            Math.PI / 2) * (89 - pieSc3(d[5]))
                                })
                                .style("fill", "none")
                                .style("stroke", d3.rgb(0, 0, 255))
                                .style("stroke-width", 1)
                                .attr("transform", "translate(" + (width / 2) + ",150)");


                            var arcs = svg.append("g");


                            var myArea = d3.svg.line()
                                .x(function (d, i) {
                                    return Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                        Math.PI / 2) * (100 + pieSc2(d[0]));
                                })
                                .y(function (d, i) {
                                    return Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                        Math.PI / 2) * (100 + pieSc2(d[0]));
                                })
                                .interpolate("linear-closed");

                            var myArea2 = d3.svg.line()
                                .x(function (d, i) {
                                    return Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                        Math.PI / 2) * (89 - pieSc2(d[1]));
                                })
                                .y(function (d, i) {
                                    return Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                        Math.PI / 2) * (89 - pieSc2(d[1]));
                                })
                                .interpolate("linear-closed");

                            var myAreaMax1 = d3.svg.line()
                                .x(function (d, i) {
                                    return Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                        Math.PI / 2) * (110 + pieSc2(d[2]));
                                })
                                .y(function (d, i) {
                                    return Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                        Math.PI / 2) * (110 + pieSc2(d[2]));
                                })
                                .interpolate("linear-closed");

                            var myAreaMax2 = d3.svg.line()
                                .x(function (d, i) {
                                    return Math.cos(i * 600 / 86400 * 2 * Math.PI -
                                        Math.PI / 2) * (89 - pieSc2(d[3]));
                                })
                                .y(function (d, i) {
                                    return Math.sin(i * 600 / 86400 * 2 * Math.PI -
                                        Math.PI / 2) * (89 - pieSc2(d[3]));
                                })
                                .interpolate("linear-closed");

                            arcs.append("path")
                                .attr("class", "MyLine")
                                .attr("d", myArea(json))
                                .style("fill", "none")
                                .style("stroke", d3.rgb(0, 0, 255))
                                .style("stroke-width", 2)
                                .style("opacity", 0.6)
                                .attr("transform", "translate(" + (width / 2) + ",150)");

                            arcs.append("path")
                                .attr("class", "MyLine")
                                .attr("d", myArea2(json))
                                .style("fill", "none")
                                .style("stroke", d3.rgb(0, 0, 255))
                                .style("stroke-width", 2)
                                .style("opacity", 0.6)
                                .attr("transform", "translate(" + (width / 2) + ",150)");


                            // arcAvg.append("path")
                            //   .attr("class","MyLine")
                            //   .attr("d",myArea(json))
                            //   .style("fill", "none")
                            //   .style("stroke",d3.rgb(0,0,255))
                            //   .style("stroke-width",2)
                            //   .style("opacity",0.6)
                            //   .attr("transform","translate("+ (width/2) +",150)");

                            // arcAvg.append("path")
                            //   .attr("class","MyLine")
                            //   .attr("d",myArea2(json))
                            //   .style("fill", "none")
                            //   .style("stroke",d3.rgb(0,0,255))
                            //   .style("stroke-width",2)
                            //   .style("opacity",0.6)
                            //   .attr("transform","translate("+ (width/2) +",150)");

                            // arcAvg.append("path")
                            //   .attr("class","MyLine")
                            //   .attr("d",myAreaMax1(json))
                            //   .style("fill", "none")
                            //   .style("stroke",d3.rgb(0,0,255))
                            //   .style("stroke-width",2)
                            //   .style("opacity",0.6)
                            //   .attr("transform","translate("+ (width/2) +",150)");

                            // arcAvg.append("path")
                            //   .attr("class","MyLine")
                            //   .attr("d",myAreaMax2(json))
                            //   .style("fill", "none")
                            //   .style("stroke",d3.rgb(0,0,255))
                            //   .style("stroke-width",2)
                            //   .style("opacity",0.6)
                            //   .attr("transform","translate("+ (width/2) +",150)");
                        });
                    });





                    d3.json("data/SinglePointDataX." + d.name + ".json", function (error, json) {

                        svgHistorgram.selectAll(".MyRect").remove();

                        var Historgramcolor = d3.interpolate(d3.rgb(255, 0, 0), d3.rgb(0, 255, 255));
                        var HistorgramcolorLinear = d3.scale.linear()
                            .domain([15, 40])
                            .range([0, 1]);

                        var colorText = d3.scale.category20();
                        var padding = {
                            left: 30,
                            right: 30,
                            top: 20,
                            bottom: 10
                        };

                        var xScale = d3.scale.ordinal()
                            .domain(d3.range(25))
                            .rangeRoundBands([0, 675 - padding.left - padding.right]);

                        //y轴的比例尺
                        var yScale = d3.scale.linear()
                            .domain([0, 100])
                            .range([50, 0]);

                        var yScale2 = d3.scale.linear()
                            .domain([0, 100])
                            .range([0, 50]);

                        //定义x轴
                        var xAxis = d3.svg.axis()
                            .scale(xScale)
                            .orient("bottom");

                        //定义y轴
                        var yAxis = d3.svg.axis()
                            .scale(yScale)
                            .orient("left");

                        var rectPadding = 1;


                        var rects1 = svgHistorgram
                            .append("g").selectAll(".MyRect")
                            .data(json[0])
                            .enter()
                            .append("rect")
                            .attr("class", "MyRect")
                            .attr("transform", "translate(" + padding.left + "," + padding.top +
                                ")")
                            .attr("x", function (d, i) {
                                return xScale1(i) + rectPadding / 2;
                            })
                            .attr("y", function (d) {
                                return yScale(d[0]) + 30;
                            })
                            .attr("width", xScale1.rangeBand() - rectPadding)
                            .attr("height", function (d) {
                                return 50 - yScale(d[0]);
                            })
                            .attr("fill", function (d) {
                                return Historgramcolor(HistorgramcolorLinear(d[0]));
                            })
                            .on("mousedown", function (d, i) {
                                rects1.attr("fill", function (d) {
                                    return Historgramcolor(HistorgramcolorLinear(d[0]));
                                })
                                rects2.attr("fill", function (d) {
                                    return Historgramcolor(HistorgramcolorLinear(d[0]));
                                })
                                d3.select(this)
                                    .attr("fill", d3.rgb(0, 255, 255))
                                svgHistorgram.selectAll(".PtoGRect").remove();
                                var rectPtoG = svgHistorgram
                                    .append("g").selectAll(".PtoGRect")
                                    .data(d[1])
                                    .enter()
                                    .append("rect")
                                    .attr("class", "PtoGRect")
                                    .attr("transform", "translate(" + padding.left + "," +
                                        padding.top + ")")
                                    .attr("x", function (d, i) {
                                        return xScale1(i) + rectPadding / 2;
                                    })
                                    .attr("y", function (d) {
                                        return 57 + 30 + 14;
                                    })
                                    .attr("width", xScale1.rangeBand() - rectPadding)
                                    .attr("height", 0)
                                    .transition()
                                    .duration(200)
                                    .ease("linear")
                                    .attr("height", function (d) {
                                        return yScale2(d);
                                    })
                                    .attr("fill", function (d) {
                                        return d3.rgb(0, 0, 255);
                                    })
                                    .on("mouseover", function (d, i) {
                                        // d3.select(this)
                                        //     .transition()
                                        //     .duration(50)
                                        //     .attr("width", xScale1.rangeBand())
                                        //     .attr("x", xScale1(i) + rectPadding/2-1)                                                     

                                        tooltip.html("乘客数为" + d + "<br/>")
                                            .style("left", (d3.event.pageX) + "px")
                                            .style("top", (d3.event.pageY + 20) + "px")
                                            .style("opacity", 1.0);
                                        tooltip.style("box-shadow", "10px 0px 0px" +
                                            Historgramcolor(HistorgramcolorLinear(d))); //在提示框后添加阴影  
                                    })
                                    .on("mousemove", function (d) {
                                        /* 鼠标移动时，更改样式 left 和 top 来改变提示框的位置 */
                                        tooltip.style("left", (d3.event.pageX) + "px")
                                            .style("top", (d3.event.pageY + 20) + "px");
                                    })
                                    .on("mouseout", function (d, i) {
                                        //鼠标移除 透明度设为0 
                                        // d3.select(this)
                                        // .transition()
                                        // .duration(100)
                                        // .attr("width", xScale1.rangeBand() - rectPadding)
                                        // .attr("x", xScale1(i) + rectPadding/2)    
                                        tooltip.style("opacity", 0.0);
                                    });
                            })
                            .on("mouseover", function (d, i) {
                                // d3.select(this)
                                //         .attr("fill",d3.rgb(0,255,255))
                                // console.log("载客车辆数为"+d+"<br/>"+" 平均速度为"+i)  
                                tooltip.html("乘客数为" + d[0] + "<br/>")
                                    .style("left", (d3.event.pageX) + "px")
                                    .style("top", (d3.event.pageY + 20) + "px")
                                    .style("opacity", 1.0);
                                tooltip.style("box-shadow", "10px 0px 0px" + Historgramcolor(
                                    HistorgramcolorLinear(d))); //在提示框后添加阴影  
                            })
                            .on("mousemove", function (d) {
                                /* 鼠标移动时，更改样式 left 和 top 来改变提示框的位置 */
                                tooltip.style("left", (d3.event.pageX) + "px")
                                    .style("top", (d3.event.pageY + 20) + "px");
                            })
                            .on("mouseout", function (d, i) {
                                // d3.select(this)
                                //     .attr("fill", Historgramcolor(HistorgramcolorLinear(d[0])));
                                //鼠标移除 透明度设为0 
                                // d3.select(this)
                                // .transition()
                                // .duration(100)
                                // .attr("width", xScale1.rangeBand() - rectPadding)
                                // .attr("x", xScale1(i) + rectPadding/2)    
                                tooltip.style("opacity", 0.0);
                            });

                        var rects2 = svgHistorgram
                            .append("g").selectAll(".MyRect")
                            .data(json[1])
                            .enter()
                            .append("rect")
                            .attr("class", "MyRect")
                            .attr("transform", "translate(" + padding.left + "," + padding.top +
                                ")")
                            .attr("x", function (d, i) {
                                return xScale1(i) + rectPadding / 2;
                            })
                            .attr("y", function (d) {
                                return 57 + 30 + 14;
                            })
                            .attr("width", xScale1.rangeBand() - rectPadding)
                            // .attr("height",0)
                            // .transition()
                            // .duration(200)
                            // .ease("linear")
                            .attr("height", function (d) {
                                return yScale2(d[0]);
                            })
                            .attr("fill", function (d) {
                                return Historgramcolor(HistorgramcolorLinear(d[0]));
                            })
                            .on("mousedown", function (d, i) {
                                rects1.attr("fill", function (d) {
                                    return Historgramcolor(HistorgramcolorLinear(d[0]));
                                })
                                rects2.attr("fill", function (d) {
                                    return Historgramcolor(HistorgramcolorLinear(d[0]));
                                })
                                d3.select(this)
                                    .attr("fill", d3.rgb(0, 255, 255))
                                svgHistorgram.selectAll(".PtoGRect").remove();
                                var rectPtoG = svgHistorgram
                                    .append("g").selectAll(".PtoGRect")
                                    .data(d[1])
                                    .enter()
                                    .append("rect")
                                    .attr("class", "PtoGRect")
                                    .attr("transform", "translate(" + padding.left + "," +
                                        padding.top + ")")
                                    .attr("x", function (d, i) {
                                        return xScale1(i) + rectPadding / 2;
                                    })
                                    .attr("y", function (d) {
                                        return 50 + 30;
                                    })
                                    .attr("width", xScale1.rangeBand() - rectPadding)
                                    .attr("height", function (d) {
                                        return 0;
                                    })
                                    .transition()
                                    .duration(200)
                                    .ease("linear")
                                    .attr("height", function (d) {
                                        return 50 - yScale(d);;
                                    })
                                    .attr("y", function (d) {
                                        return yScale(d) + 30;
                                    })
                                    .attr("fill", function (d) {
                                        return d3.rgb(0, 0, 255);
                                    })
                                    .on("mouseover", function (d, i) {
                                        // d3.select(this)
                                        //     .transition()
                                        //     .duration(50)
                                        //     .attr("width", xScale1.rangeBand())
                                        //     .attr("x", xScale1(i) + rectPadding/2-1)                                                     

                                        tooltip.html("乘客数为" + d + "<br/>")
                                            .style("left", (d3.event.pageX) + "px")
                                            .style("top", (d3.event.pageY + 20) + "px")
                                            .style("opacity", 1.0);
                                        tooltip.style("box-shadow", "10px 0px 0px" +
                                            Historgramcolor(HistorgramcolorLinear(d))); //在提示框后添加阴影  
                                    })
                                    .on("mousemove", function (d) {
                                        /* 鼠标移动时，更改样式 left 和 top 来改变提示框的位置 */
                                        tooltip.style("left", (d3.event.pageX) + "px")
                                            .style("top", (d3.event.pageY + 20) + "px");
                                    })
                                    .on("mouseout", function (d, i) {
                                        //鼠标移除 透明度设为0 
                                        // d3.select(this)
                                        // .transition()
                                        // .duration(100)
                                        // .attr("width", xScale1.rangeBand() - rectPadding)
                                        // .attr("x", xScale1(i) + rectPadding/2)    
                                        tooltip.style("opacity", 0.0);
                                    });
                            })
                            .on("mouseover", function (d, i) {
                                // d3.select(this)
                                //         .attr("fill",d3.rgb(0,255,255))
                                // d3.select(this)
                                //     .transition()
                                //     .duration(50)
                                //     .attr("width", xScale1.rangeBand())
                                //     .attr("x", xScale1(i) + rectPadding/2-1)                                                     

                                tooltip.html("乘客数为" + d[0] + "<br/>")
                                    .style("left", (d3.event.pageX) + "px")
                                    .style("top", (d3.event.pageY + 20) + "px")
                                    .style("opacity", 1.0);
                                tooltip.style("box-shadow", "10px 0px 0px" + Historgramcolor(
                                    HistorgramcolorLinear(d))); //在提示框后添加阴影  
                            })
                            .on("mousemove", function (d) {
                                /* 鼠标移动时，更改样式 left 和 top 来改变提示框的位置 */
                                tooltip.style("left", (d3.event.pageX) + "px")
                                    .style("top", (d3.event.pageY + 20) + "px");
                            })
                            .on("mouseout", function (d, i) {
                                // d3.select(this)
                                //       .attr("fill", Historgramcolor(HistorgramcolorLinear(d[0])));  
                                //鼠标移除 透明度设为0 
                                // d3.select(this)
                                // .transition()
                                // .duration(100)
                                // .attr("width", xScale1.rangeBand() - rectPadding)
                                // .attr("x", xScale1(i) + rectPadding/2)    
                                tooltip.style("opacity", 0.0);
                            });
                    });

                    //console.log(d.name +","+ d.num);
                });

            force
                .nodes(graph.nodes)
                .links(graph.links)
                // .linkDistance(function(d,i){
                //   console.log(d);
                //   return  d.value;
                // })
                .on("tick", tick)
                .start();

            function tick() {
                node.attr("cx", function (d) {
                        return d.x = Math.max(radiusf, Math.min(widthf - radiusf, d.x));
                    })
                    .attr("cy", function (d) {
                        return d.y = Math.max(radiusf, Math.min(heightf - radiusf, d.y));
                    });

                link.attr("x1", function (d) {
                        return d.source.x;
                    })
                    .attr("y1", function (d) {
                        return d.source.y;
                    })
                    .attr("x2", function (d) {
                        return d.target.x;
                    })
                    .attr("y2", function (d) {
                        return d.target.y;
                    });
            }

            link.attr("class", function (d) {
                return "KLine" + d.source.color + d.target.color;
            });
        });
    }
</script>

<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script>
    console.log(document.getElementById("dituContent").offsetHeight);
    console.log(document.getElementById("dituContent").offsetWidth);


    var svgHistorgram = d3.select("body")
        .select("#Historgram") //选取要添加画布的div
        .append("svg")
        .attr("width", 650)
        .attr("height", 350)

    var Historgramcolor = d3.interpolate(d3.rgb(255, 0, 0), d3.rgb(0, 255, 255));
    var HistorgramcolorLinear = d3.scale.linear()
        .domain([15, 40])
        .range([0, 1]);

    var colorText = d3.scale.category20();

    var dataset = [2, 4, 1, 7, 8, 6, 11, 12, 20, 23, 19, 17, 15, 28, 30, 16, 18, 17, 20, 16, 10, 7, 6, 8];
    var dataset1 = [
        [280, 32],
        [250, 29],
        [225, 28],
        [211, 29],
        [199, 27],
        [188, 28],
        [179, 27],
        [134, 26],
        [139, 26],
        [137, 24],
        [143, 28],
        [126, 24],
        [103, 26],
        [105, 27],
        [95, 23],
        [90, 23],
        [76, 21],
        [71, 22],
        [75, 25],
        [82, 28],
        [82, 27],
        [80, 33],
        [88, 28],
        [97, 34],
        [123, 32],
        [152, 33],
        [201, 33],
        [253, 29],
        [284, 29],
        [332, 28],
        [363, 24],
        [392, 26],
        [414, 21],
        [429, 21],
        [435, 22],
        [440, 23],
        [411, 24],
        [420, 23],
        [397, 23],
        [362, 26],
        [362, 26],
        [355, 24],
        [352, 24],
        [338, 25],
        [333, 27],
        [346, 24],
        [360, 25],
        [357, 26],
        [358, 26],
        [358, 25],
        [320, 28],
        [308, 27],
        [332, 27],
        [355, 27],
        [379, 26],
        [401, 25],
        [410, 24],
        [412, 26],
        [412, 24],
        [412, 21],
        [406, 22],
        [433, 21],
        [431, 25],
        [422, 23],
        [409, 23],
        [394, 22],
        [382, 26],
        [404, 24],
        [417, 24],
        [413, 22],
        [409, 20],
        [401, 20],
        [391, 18],
        [375, 17],
        [385, 21],
        [373, 20],
        [400, 21],
        [285, 22],
        [1, 40],
        [52, 27],
        [119, 19],
        [116, 20],
        [119, 19],
        [311, 24],
        [382, 25],
        [372, 25],
        [386, 27],
        [398, 25],
        [413, 26],
        [387, 27],
        [377, 26],
        [347, 29],
        [355, 29],
        [340, 27],
        [333, 28],
        [293, 29]
    ];

    var dataset2 = [
        [348, 31],
        [307, 28],
        [278, 26],
        [232, 25],
        [207, 24],
        [189, 26],
        [156, 25],
        [138, 22],
        [107, 21],
        [118, 25],
        [113, 25],
        [128, 27],
        [194, 30],
        [301, 29],
        [373, 27],
        [438, 24],
        [457, 21],
        [470, 22],
        [464, 24],
        [428, 23],
        [414, 26],
        [411, 23],
        [414, 26],
        [417, 25],
        [445, 24],
        [393, 27],
        [421, 27],
        [448, 25],
        [465, 25],
        [473, 24],
        [478, 22],
        [478, 24],
        [458, 23],
        [459, 25],
        [474, 23],
        [462, 20],
        [451, 18],
        [448, 21],
        [425, 21],
        [114, 25],
        [137, 18],
        [341, 23],
        [469, 25],
        [485, 27],
        [466, 27],
        [447, 26],
        [437, 28],
        [414, 28],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0]
    ];

    var dataset3 = [
        [409, 30],
        [344, 26],
        [268, 23],
        [223, 25],
        [164, 21],
        [171, 25],
        [346, 28],
        [468, 25],
        [491, 21],
        [479, 24],
        [465, 25],
        [476, 25],
        [492, 25],
        [490, 26],
        [505, 25],
        [511, 22],
        [502, 23],
        [507, 23],
        [499, 18],
        [462, 22],
        [371, 24],
        [520, 25],
        [509, 26],
        [496, 29],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0],
        [0, 0]
    ];

    var padding = {
        left: 30,
        right: 30,
        top: 20,
        bottom: 10
    };

    var tooltip = d3.select("body")
        .append("div")
        .attr("class", "tooltip")
        .style("opacity", 0.0);

    //x轴的比例尺
    var xScale = d3.scale.ordinal()
        .domain(d3.range(25))
        .rangeRoundBands([0, 675 - padding.left - padding.right]);

    //y轴的比例尺
    var yScale = d3.scale.linear()
        .domain([0, d3.max(dataset)])
        .range([0, 200]);

    //定义x轴
    var xAxis = d3.svg.axis()
        .scale(xScale)
        .orient("bottom")
        .tickSize(2);

    var xAxis2 = d3.svg.axis()
        .scale(xScale)
        .orient("bottom")
        .tickSize(2);

    //定义y轴
    var yAxis = d3.svg.axis()
        .scale(yScale)
        .orient("left");

    var rectPadding = 2;

    //添加矩形元素
    // var rects = svgHistorgram
    // .append("g").selectAll(".MyRect")
    //         .data(dataset)
    //         .enter()
    //         .append("rect")
    //         .attr("class","MyRect")
    //         .attr("transform","translate(" + padding.left + "," + padding.top + ")")
    //         .attr("x", function(d,i){
    //             return xScale(i) + rectPadding/2;
    //         } )
    //         .attr("y",function(d){
    //             return 185;
    //         })
    //         .attr("width", xScale.rangeBand() - rectPadding )
    //         .attr("height", function(d){
    //             return yScale(d);
    //         });


    //添加x轴
    svgHistorgram.append("g")
        .attr("class", "axis")
        .attr("transform", "translate(" + padding.left + "," + 100 + ")")
        .call(xAxis);

    svgHistorgram.append("g")
        .attr("class", "axis2")
        .attr("transform", "translate(" + padding.left + "," + 118 + ")")
        .call(xAxis2);

    var xScale1 = d3.scale.ordinal()
        .domain(d3.range(144))
        .rangeRoundBands([0, 675 - padding.left - padding.right]);

    //y轴的比例尺
    var yScale1 = d3.scale.linear()
        .domain([0, 600])
        .range([190, 0]);

    //定义x轴
    var xAxis1 = d3.svg.axis()
        .scale(xScale1)
        .orient("bottom");

    //定义y轴
    var yAxis1 = d3.svg.axis()
        .scale(yScale1)
        .orient("left");

    var rectPadding1 = 4;

    //添加矩形元素
    // var rects1 = svgHistorgram
    // .append("g").selectAll(".MyRect")
    //         .data(dataset1)
    //         .enter()
    //         .append("rect")
    //         .attr("class","MyRect")
    //         .attr("transform","translate(" + padding.left + "," + padding.top + ")")
    //         .attr("x", function(d,i){
    //             return xScale1(i) + rectPadding/2;
    //         } )
    //         .attr("y",function(d){
    //             return yScale1(d[0])-20-10;
    //         })
    //         .attr("width", xScale1.rangeBand() - rectPadding )
    //         .attr("height", function(d){
    //             return 190-yScale1(d[0]);
    //         })
    //         .attr("fill", function(d) 
    //         {
    //             return Historgramcolor(HistorgramcolorLinear(d[1]));
    //         })
    //         .on("mouseover",function(d,i){
    //         // d3.select(this)
    //         //     .transition()
    //         //     .duration(50)
    //         //     .attr("width", xScale1.rangeBand())
    //         //     .attr("x", xScale1(i) + rectPadding/2-1)                                                     

    //         console.log("载客车辆数为"+d[0]+"<br/>"+" 平均速度为"+d[1])  
    //         tooltip.html("载客车辆数为"+d[0]+"<br/>"+" 平均速度为"+d[1])  
    //             .style("left",(d3.event.pageX)+"px")  
    //             .style("top",(d3.event.pageY+20)+"px")  
    //             .style("opacity",1.0);  
    //         tooltip.style("box-shadow","10px 0px 0px"+Historgramcolor(HistorgramcolorLinear(d[1])));//在提示框后添加阴影  
    //         })  
    //         .on("mousemove",function(d){  
    //             /* 鼠标移动时，更改样式 left 和 top 来改变提示框的位置 */  
    //             tooltip.style("left",(d3.event.pageX)+"px")  
    //                     .style("top",(d3.event.pageY+20)+"px");  
    //         })  
    //         .on("mouseout",function(d,i){  
    //             //鼠标移除 透明度设为0 
    //             // d3.select(this)
    //             // .transition()
    //             // .duration(100)
    //             // .attr("width", xScale1.rangeBand() - rectPadding)
    //             // .attr("x", xScale1(i) + rectPadding/2)    
    //             tooltip.style("opacity",0.0);  
    //         });

    function changedHistorgramradio(value) {
        if (value == "1") {
            rects1
                .data(dataset1)
                .transition()
                .duration(500)
                .attr("y", function (d) {
                    return yScale1(d[0]) - 20 - 10;
                })
                .attr("x", function (d, i) {
                    return xScale1(i) + rectPadding / 2;
                })
                .attr("height", function (d) {
                    return 190 - yScale1(d[0]);
                })
                .attr("width", xScale1.rangeBand() - rectPadding)
                .attr("fill", function (d) {
                    return Historgramcolor(HistorgramcolorLinear(d[1]));
                });
        } else if (value == "2") {
            rects1
                .data(dataset2)
                .transition()
                .duration(500)
                .attr("y", function (d) {
                    return yScale1(d[0]) - 20 - 10;
                })
                .attr("x", function (d, i) {
                    return xScale1(i) * 2 + rectPadding / 2 - 18;
                })
                .attr("height", function (d) {
                    return 190 - yScale1(d[0]);
                })
                .attr("width", (xScale1.rangeBand() - rectPadding) * 2)
                .attr("fill", function (d) {
                    return Historgramcolor(HistorgramcolorLinear(d[1]));
                });
            //      .on("mouseover",function(d,i){
            //                                             d3.select(this)
            //                                                 .transition()
            //                                                 .duration(50)
            //                                                 .attr("width", (xScale1.rangeBand())*2)
            //                                                 .attr("x",xScale1(i)*2 + rectPadding/2-18-1);                                                     

            //                                             console.log("载客车辆数为"+d[0]+"<br/>"+" 平均速度为"+d[1])  
            //                                             tooltip.html("载客车辆数为"+d[0]+"<br/>"+" 平均速度为"+d[1])  
            //                                                 .style("left",(d3.event.pageX)+"px")  
            //                                                 .style("top",(d3.event.pageY+20)+"px")  
            //                                                 .style("opacity",1.0);  
            //                                             tooltip.style("box-shadow","10px 0px 0px"+Historgramcolor(HistorgramcolorLinear(d[1])));//在提示框后添加阴影  
            //                                             })  
            //                                             .on("mousemove",function(d){  
            //                                                 /* 鼠标移动时，更改样式 left 和 top 来改变提示框的位置 */  
            //                                                 tooltip.style("left",(d3.event.pageX)+"px")  
            //                                                         .style("top",(d3.event.pageY+20)+"px");  
            //                                             })  
            //                                             .on("mouseout",function(d,i){  
            //                                                 //鼠标移除 透明度设为0 
            //                                                 d3.select(this)
            //                                                 .transition()
            //                                                 .duration(100)
            //                                                 .attr("width", (xScale1.rangeBand() - rectPadding)*2)
            //                                                 .attr("x", xScale1(i)*2 + rectPadding/2-18)    
            //                                                 tooltip.style("opacity",0.0);  
            //                                             });
        } else if (value == "3") {
            rects1
                .data(dataset3)
                .transition()
                .duration(500)
                .attr("y", function (d) {
                    return yScale1(d[0]) - 20 - 10;
                })
                .attr("x", function (d, i) {
                    return xScale1(i) * 4 + rectPadding / 2 - 57;
                })
                .attr("height", function (d) {
                    return 190 - yScale1(d[0]);
                })
                .attr("width", (xScale1.rangeBand() - rectPadding) * 4)
                .attr("fill", function (d) {
                    return Historgramcolor(HistorgramcolorLinear(d[1]));
                });
        }
    }
</script>

</html>